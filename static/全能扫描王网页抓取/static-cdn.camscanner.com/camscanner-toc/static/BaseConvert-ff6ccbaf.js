import{m as L,r as z,Z as O}from"./layout-9f15c196.js";import{n as R}from"./mainTopSetting-c285896d.js";import{p as U,c as q,t as A}from"./ToolsDesc-651310a8.js";import{t as M}from"./ToolsBoxTop-17f3c965.js";import{l as G}from"./LoginDialog-c0cc2372.js";import{c as b}from"./config-8adb8f72.js";import{d as V,u as _,G as H,_ as j,r as d,o as p,c as h,a as o,k as n,p as v,t as c,g,w as J,v as K,l as T,z as W,q as Z,s as Q}from"./vendor-f6f18e65.js";import{t as a,c as s,b3 as X,a as m,d as Y,f as P,bo as x,bp as S}from"./header-9cdc9e16.js";import{u as $}from"./user-store-a4f4557a.js";import"./libs-250e5f01.js";import"./sapi-65078bb6.js";import"./CommonTooltipBlack-dc42593b.js";import"./uapi-36a28288.js";import"./LoginPage-b10c991b.js";import"./LoginHeader-2fea9369.js";import"./RegisterPage-33145d70.js";const r="toolconvert",ee=V({metaInfo(){return{link:[{rel:"canonical",href:`https://www.camscanner.com${this.$route.path}`}]}},components:{mainLeft:L,mainTopSetting:R,progressBar:U,convertSuccess:q,toolsBoxTop:M,dirStructure:z,loginDialog:G,toolsDesc:A},data:function(){return{pageType:"tools",token:"",isDomestic:!0,fileId:"",fileName:"",fileSize:0,sid:"",eid:"",downloadType:"",downloadLink:"",step:"beforeUpload",source:"",uploadPercent:1,uploadPercentInterval:0,processPercent:1,processPercentInterval:0,processFileInterval:0,isEdit:!1,dirShow:!1,docShow:!0,isMove:!1,docId:"",result:{},showFromCsDoc:!1,dropFile:null,entryDom:"",hasProcess:!1}},computed:{loginText(){return this.$t("cs_638_convert_tips_unlogin",[`<a target="_blank" class='agr_text'>`+this.$t("cs_638_convert_signin_hyperlink")+"</a>"])},conf(){return b}},created(){a(r,"pv");const e=_.CancelToken;this.source=e.source(),this.initData()},mounted(){const e=this;s.off("toolsRoute"),s.on("toolsRoute",()=>{e.endTask(),e.initData()});const t=document.getElementById("app");t&&(t.addEventListener("drop",this.dropUpload,!1),t.addEventListener("dragleave",this.eventStop),t.addEventListener("dragenter",this.eventStop),t.addEventListener("dragover",this.eventStop)),setTimeout(function(){if(e.$route.query.lp==="sem"){if(!window._hmt)return;window._hmt.push(["_trackEvent","活动推广","进入页面"])}},100);const i=document.querySelector(".agr_text");i&&i.addEventListener("click",()=>{this.$refs.loginDialog.openDialog()})},beforeUnmount(){s.off("toolsRoute"),this.destroyDrop(),this.endTask()},methods:{handlerInput(){a(r,"selectfile","file_device"),a(r,"selectfile")},dropUpload(e){this.eventStop(e);const t=[];[].forEach.call(e.dataTransfer.files,function(l){t.push(l)},!1),t.length!==0&&(this.dropFile=t[0],this.getFile())},destroyDrop(){const e=this,t=document.getElementById("app");t&&(t.removeEventListener("drop",e.dropUpload,!1),t.removeEventListener("dragleave",e.eventStop),t.removeEventListener("dragenter",e.eventStop),t.removeEventListener("dragover",e.eventStop))},eventStop(e){e.stopPropagation(),e.preventDefault(),(e.type==="drop"||e.type==="dragleave")&&e.target===this.entryDom&&(document.getElementsByClassName("file_drop")[0].style.display="none",document.getElementsByClassName("route-dom")[0].style.opacity="1"),e.type==="dragenter"&&(this.entryDom=e.target,document.getElementsByClassName("file_drop")[0].style.display="flex",document.getElementsByClassName("route-dom")[0].style.opacity="0.2")},originGetFile(){a(r,"selectfile","file_cs"),this.token?this.dirShow=!0:this.$refs.loginDialog.openDialog()},handlePage(e){if(e.type==="dir"){s.emit("toast",{msg:this.$t("web_3_tool_choosefile_cs")});return}this.result=e,this.getFile()},closeDirDialog(){this.dirShow=!1,this.result=null},initData(){const e=this;if(this.$nextTick(()=>{X(e,e.$route.meta)}),this.$i18n&&this.$i18n.locale&&this.$i18n.locale==="zh-cn"&&this.$route.params.lang!=="cn"){if(e.$route.query.lp==="sem"){this.$router.replace({name:`${this.$route.name}`,query:{lp:"sem"}});return}this.$router.replace({name:`${this.$route.name}`})}if(this.$i18n&&this.$i18n.locale&&this.$i18n.locale!=="zh-cn"){if(e.$route.query.lp==="sem"){this.$router.replace({name:`${this.$route.name}`,query:{lp:"sem"}});return}this.$router.replace({name:`${this.$route.name}`})}if(m("hasReturn")&&m("hasReturn")==="1"&&m("toolsSuccess")){const l=JSON.parse(m("toolsSuccess")||"{}");for(const f in l)this[f]=l[f];const y=_.CancelToken;this.source=y.source()}else this.reSetData();this.endTask(),this.token=$().token,this.isDomestic=$().isDomestic;const t=_.CancelToken;this.source=t.source(),["pdftoword","pdftoexcel","pdftoppt","pdftopic"].includes(this.$route.name)&&(this.showFromCsDoc=!0)},reSetData(){const e=this.initOptions();for(const t in e)this[t]=e[t]},initOptions(){return{pageType:"tools",token:"",isDomestic:!0,fileId:"",fileName:"",fileSize:0,sid:"",eid:"",downloadType:"",downloadLink:"",step:"beforeUpload",source:"",uploadPercent:1,uploadPercentInterval:0,processPercent:1,processPercentInterval:0,processFileInterval:0,isEdit:!1,dirShow:!1,docShow:!0,isMove:!1,docId:"",result:{},showFromCsDoc:!1,dropFile:null,entryDom:"",hasProcess:!1}},checkFile(){var e;if(this.result&&this.result.id&&this.result.title)return this.fileSize=0,this.docId=this.result.id,this.fileName=this.result.title,{file:""};{let t;if(this.dropFile?t=this.dropFile:t=this.$refs.selectFile.files[0],this.fileSize=t.size,this.fileName=t.name,$().userType===this.conf.userTypeEnterprise){if(this.fileSize>5e8){s.emit("toast",{msg:this.$t("web_3_upload_limit")});return}}else if(this.fileSize>1e8){s.emit("toast",{msg:this.$t("web_3_upload_limit")});return}if(!((e=this.$route.meta.accept)!=null&&e.split(",").includes(this.fetchFileType(this.fileName)))){s.emit("toast",{msg:this.$t(this.$route.meta.uploadTypeWorry||"")});return}return{file:t}}},errorToast(e){switch(e.ret){case 314:s.emit("toast",{msg:this.$t("web_3_toolbox_numlimit")});break;case 319:s.emit("toast",{msg:this.$t("web_3_tool_upload_encrypted")});break;case 320:s.emit("toast",{msg:this.$t("web_3_upload_pdfpage_limit")});break;case 321:s.emit("toast",{msg:this.$t("web_3_mergepdf_limit",[5])});break;case 322:s.emit("toast",{msg:this.$t("web_3_upload_limit")});break;case 323:break;case 333:s.emit("toast",{msg:this.$t("web_3_upload_jpg_limit")});break}},getFile(){const e=this,{file:t}=this.checkFile();if(!Y(this.fileName)){s.emit("toast",{msg:this.$t("web_3_rename_special")});return}this.closeDirDialog(),this.step="uploading",this.uploadProgressBar(),this.$route.meta.service(this.token,t,this.fileSize,this.fileName.lastIndexOf(".")===-1?this.fileName:this.fileName.substring(0,this.fileName.lastIndexOf(".")),this.source,this.docId).then(l=>{l.ret===0?(e.fileId=l.data.file_id,a(r,"tool_upload","success"),e.processFile()):(P(l,this).flag||s.emit("toast",{msg:this.$t("web_3_tool_upload_failed")}),a(r,"tool_upload","failed"),e.step="beforeUpload",e.initData()),clearInterval(e.uploadPercentInterval)}).catch(l=>{l.message!=="toolsRouter"&&(clearInterval(e.uploadPercentInterval),a(r,"tool_upload","failed"),l.xerrcode==="10001"?s.emit("toast",{msg:this.$t("web_422_tool_use_frequent")}):s.emit("toast",{msg:this.$t("web_3_tool_upload_failed")}),e.initData())})},processFile(){const e=this;e.step="processing",e.processProgressBar(),e.convertFile(),e.processFileInterval=window.setInterval(()=>{e.convertFile()},3e3)},convertFile(){const e=this;O(e.token,this.fileName.lastIndexOf(".")===-1?this.fileName:this.fileName.substring(0,this.fileName.lastIndexOf(".")),e.fileId,this.$route.meta.convertType,"web",this.source).then(t=>{if(this.hasProcess=!0,t.ret===0){if(t.data&&t.data.sid){clearInterval(e.processFileInterval),clearInterval(e.processPercentInterval),a(r,"tool_Convert","success"),e.processPercentInterval=0,e.processPercent=100,e.sid=t.data.sid,e.eid=t.data.encrypt_id,e.downloadType=t.data.type;const i={platform:"web",type:e.downloadType,sid:e.sid,title:this.fileName.lastIndexOf(".")===-1?this.fileName:this.fileName.substring(0,this.fileName.lastIndexOf("."))};e.eid&&(i.encrypt_id=e.eid);const l=this.token?"SAPI_DOC_FOREIGN":"DAPI";e.downloadLink=b.api[l]+`/download_file?${H.stringify(i)}`,setTimeout(()=>{e.step="finish"},100),a(r,"tool_Convertsuccess"),a(r,"tool_success")}}else clearInterval(e.processFileInterval),clearInterval(e.processPercentInterval),P(t,this).flag||s.emit("toast",{msg:this.$t("web_3_tool_convert_failed")}),a(r,"tool_Convertfaild"),a(r,"tool_Convert","failed"),e.initData()}).catch(t=>{throw clearInterval(e.processFileInterval),clearInterval(e.processPercentInterval),t.message==="toolsRouter"||(a(r,"tool_Convert","failed"),s.emit("toast",{msg:this.$t("web_3_tool_convert_failed")}),a(r,"tool_Convertfaild"),e.initData()),t})},uploadProgressBar(){const e=this;e.uploadPercentInterval=window.setInterval(()=>{e.uploadPercent<10?e.uploadPercent+=2:e.uploadPercent<30&&(e.uploadPercent+=1)},1e3)},processProgressBar(){const e=this;e.processPercentInterval=window.setInterval(()=>{e.uploadPercent<40?e.uploadPercent+=2:e.uploadPercent<90&&(e.uploadPercent+=1)},1e3)},fetchFileType(e){let t;e=e.toLocaleLowerCase();try{const i=e.split(".");t=i[i.length-1]}catch(i){t=""}return"."+t},endTask(){clearInterval(this.processFileInterval),clearInterval(this.processPercentInterval),clearInterval(this.uploadPercentInterval),this.source&&this.source.cancel("toolsRouter")},returnBack(){this.endTask(),this.initData()}}});const w=e=>(Z("data-v-d7cfabf7"),e=e(),Q(),e),te={class:"main"},se={class:"main_right"},oe={class:"tool_main_wrap"},ie={class:"tool_title"},le=["src"],ae={class:"tool_desc"},re={key:0,class:"tool_tips"},ne=["innerHTML"],ce={key:1,class:"upload_wrap"},de={class:"upload_btn"},pe=w(()=>o("img",{src:x,alt:""},null,-1)),ue={class:"upload_btn_box"},he={class:"upload_show"},me=["accept"],fe={class:"drop_tip"},_e={key:2,class:"upload_wrap"},ve=w(()=>o("img",{class:"upload_img",src:S,alt:""},null,-1)),ge={class:"uploading_tip"},$e={class:"upload_progress_bar"},we={key:3,class:"upload_wrap"},ye=w(()=>o("img",{class:"upload_img",src:S,alt:""},null,-1)),Ie={class:"uploading_tip"},ke={class:"upload_progress_bar"};function De(e,t,i,l,y,f){const F=d("toolsBoxTop"),I=d("Plus"),k=d("el-icon"),C=d("toolsDesc"),D=d("progressBar"),N=d("convertSuccess"),E=d("dirStructure"),B=d("loginDialog");return p(),h("div",te,[o("div",se,[n(F),o("div",oe,[o("h1",ie,[o("img",{src:e.$route.meta.convertImg,alt:""},null,8,le),v(" "+c(e.$t(e.$route.meta.toolsTitle||"")),1)]),o("h2",ae,c(e.$t(e.$route.meta.toolsDesc||"")),1),e.hasProcess&&e.token?(p(),h("h2",re,c(e.$t("cs_638_convert_tips_login")),1)):g("",!0),J(o("h2",{class:"tool_tips",innerHTML:e.loginText},null,8,ne),[[K,!e.token]]),e.step==="beforeUpload"?(p(),h("div",ce,[o("div",de,[pe,o("div",ue,[o("div",he,[o("input",{class:"upload_file",type:"file",onClick:t[0]||(t[0]=(...u)=>e.handlerInput&&e.handlerInput(...u)),onChange:t[1]||(t[1]=u=>e.getFile()),ref:"selectFile",multiple:"",accept:e.$route.meta.accept},null,40,me),n(k,null,{default:T(()=>[n(I)]),_:1}),v(" "+c(e.$t("web_3_tool_uploadfile_device")),1)]),e.showFromCsDoc?(p(),h("div",{key:0,class:"upload_show",onClick:t[2]||(t[2]=(...u)=>e.originGetFile&&e.originGetFile(...u))},[n(k,null,{default:T(()=>[n(I)]),_:1}),v(" "+c(e.$t("web_3_tool_uploadfile_cs")),1)])):g("",!0)])]),o("div",fe,c(e.$t("web_3_tool_upload")),1),n(C,{seoArray:[{title:e.$t(e.$route.meta.h3Title1||""),desc:e.$t(e.$route.meta.h3Desc1||"")},{title:e.$t(e.$route.meta.h3Title2||""),desc:e.$t(e.$route.meta.h3Desc2||"")},{title:e.$t(e.$route.meta.h3Title3||""),desc:e.$t(e.$route.meta.h3Desc3||"")},{title:e.$t(e.$route.meta.h3Title4||""),desc:e.$t(e.$route.meta.h3Desc4||"")},{title:e.$t(e.$route.meta.h3Title5||""),desc:e.$t(e.$route.meta.h3Desc5||"")},{title:e.$t(e.$route.meta.h3Title6||""),desc:e.$t(e.$route.meta.h3Desc6||"")}]},null,8,["seoArray"])])):e.step==="uploading"?(p(),h("div",_e,[ve,o("div",ge,c(e.$t("web_3_tool_uploading"))+" "+c(Math.floor(e.uploadPercent))+"%",1),o("div",$e,[n(D,{show:1,percent:e.uploadPercent},null,8,["percent"])])])):e.step==="processing"?(p(),h("div",we,[ye,o("div",Ie,c(e.$t("web_3_tool_processing"))+" "+c(Math.floor(e.uploadPercent))+"%",1),o("div",ke,[n(D,{show:1,percent:e.uploadPercent},null,8,["percent"])])])):e.step==="finish"?(p(),W(N,{key:4,fileName:e.fileName,"onUpdate:fileName":t[3]||(t[3]=u=>e.fileName=u),downloadType:e.downloadType,sid:e.sid,eid:e.eid,type:e.$route.meta.fileType,downloadLink:e.downloadLink,step:e.step},null,8,["fileName","downloadType","sid","eid","type","downloadLink","step"])):g("",!0)])]),n(E,{hasNewDir:!1,show:e.dirShow,docShow:!0,isMove:e.isMove,onConfirm:e.handlePage,onCancel:e.closeDirDialog},null,8,["show","isMove","onConfirm","onCancel"]),n(B,{ref:"loginDialog"},null,512)])}const Me=j(ee,[["render",De],["__scopeId","data-v-d7cfabf7"]]);export{Me as default};
