import{d as M,_ as N,r as g,o as _,c as f,a as t,t as a,k as m,E as B,w as I,v as q,l as C,F as Z,f as x,z as L,q as O,s as D,g as y,p as T,e as ge,y as he,j as me,n as F}from"./vendor-f6f18e65.js";import{s as v,aL as V,b4 as S,b5 as ee,b6 as oe,aa as W,b7 as we,b8 as fe,b9 as be,I as ve,t as w,ba as j,bb as ye,aG as $,aH as R,bc as E,i as P,h as $e,a as k,a9 as ke,L as Q,bd as J,N as K,a0 as Le,be as X,bf as Ce}from"./header-9cdc9e16.js";import{q as A,b as te,d as ie,e as Se,u as Ve,v as Ee}from"./uapi-36a28288.js";import{c as b}from"./config-8adb8f72.js";import{t as ne}from"./CommonTooltipBlack-dc42593b.js";import{l as Be}from"./LoginHeader-2fea9369.js";import{s as G}from"./layout-9f15c196.js";import{u as H}from"./user-store-a4f4557a.js";import"./mainTopSetting-c285896d.js";import"./sapi-65078bb6.js";import"./libs-250e5f01.js";const Te=M({components:{},data:function(){return{password:""}},computed:{upLevel(){return this.$parent}},created(){const e=this;this.$nextTick(()=>{e.$refs.emailLoginPwd.focus()})},methods:{toForgat(){var e;v("forgat_ac",(e=this.upLevel)==null?void 0:e.account,new Date().getTime()+36e6),this.$router.push({name:"forgat",query:{source:"email"}})},emailBack(){this.upLevel.emailBack()},emailLoginByPwd(){this.upLevel.emailLoginByPwd(this.password)}}});const Ie={class:"step_email_login"},qe={class:"login_main"},Me={class:"login_back"},Ne={class:"login-text"},Ue={class:"login_title"},Pe={class:"login_desc"},je={class:"login_input"},Re={class:"login_input"},Ae={class:"login_pass"};function Oe(e,o,n,i,p,u){const l=g("el-input");return _(),f("div",Ie,[t("div",qe,[t("div",Me,[t("div",Ne,[t("i",{class:"cs-icon-arrow-left",onClick:o[0]||(o[0]=(...d)=>e.emailBack&&e.emailBack(...d))}),t("h2",Ue,a(e.$t("web_3_sign_email")),1)]),t("h3",Pe,a(e.$t("web_3_sign_emailtip")),1)]),t("div",je,[m(l,{name:"email",modelValue:e.upLevel.account,"onUpdate:modelValue":o[1]||(o[1]=d=>e.upLevel.account=d),placeholder:e.$t("web_3_sign_input"),disabled:!0},null,8,["modelValue","placeholder"])]),t("div",Re,[m(l,{onKeyup:B(e.emailLoginByPwd,["enter","native"]),ref:"emailLoginPwd",modelValue:e.password,"onUpdate:modelValue":o[2]||(o[2]=d=>e.password=d),placeholder:e.$t("web_3_sign_psw"),"show-password":""},null,8,["onKeyup","modelValue","placeholder"])]),t("div",Ae,[I(t("div",{class:"login_error el-icon-warning"},a(e.upLevel.loginMsg),513),[[q,e.upLevel.loginErrorShow]]),t("a",{onClick:o[3]||(o[3]=(...d)=>e.toForgat&&e.toForgat(...d))},a(e.$t("web_3_sign_forget")),1)]),t("div",{class:"btn_green login_btn_bottom",onClick:o[4]||(o[4]=(...d)=>e.emailLoginByPwd&&e.emailLoginByPwd(...d))},a(e.$t("web_3_sign_btn")),1)])])}const De=N(Te,[["render",Oe],["__scopeId","data-v-1f974d66"]]),Fe=M({components:{},watch:{areaCode(e){e&&(v("area_code",e,V()*365),S())}},data:function(){return{password:"",verifyCode:"",areaCode:"",areaMap:[]}},computed:{subComponent(){return this.$parent}},created(){this.areaMap=ee(this.$i18n.locale),this.areaCode=oe()[this.$i18n.locale].split(",")[0];const e=this;this.$nextTick(()=>{e.$refs.mobileLoginPwd.focus()})},methods:{toForgat(){v("forgat_ac",this.subComponent.account,new Date().getTime()+36e6),this.$router.push({name:"forgat",query:{source:"mobile"}})},emailBack(){this.subComponent.emailBack()},emailLoginByPwd(){this.subComponent.emailLoginByPwd(this.password,this.verifyCode,"password",this.areaCode)}}});const Ke=e=>(O("data-v-0e55d652"),e=e(),D(),e),Ge={class:"step_mobile_login"},He={class:"login_main"},ze={class:"login_back"},We={class:"back_box"},Qe={class:"login-text"},Je={class:"login_title"},Xe={class:"login_desc"},Ye={class:"login_input"},Ze={class:"login_input"},xe={class:"login_input"},eo=Ke(()=>t("input",{type:"password",style:{display:"none"}},null,-1)),oo={class:"login_pass"};function to(e,o,n,i,p,u){const l=g("el-option"),d=g("el-select"),s=g("el-input");return _(),f("div",Ge,[t("div",He,[t("div",ze,[t("div",We,[t("div",Qe,[t("i",{class:"cs-icon-arrow-left",onClick:o[0]||(o[0]=(...r)=>e.emailBack&&e.emailBack(...r))}),t("h2",Je,a(e.$t("web_3_sign_mobile")),1)]),t("h3",Xe,a(e.$t("web_3_sign_mobiletip")),1)])]),t("div",Ye,[m(d,{filterable:"",modelValue:e.areaCode,"onUpdate:modelValue":o[1]||(o[1]=r=>e.areaCode=r),placeholder:e.$t("cs_648_login_select")},{default:C(()=>[(_(!0),f(Z,null,x(e.areaMap,r=>(_(),L(l,{key:r.index,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),t("div",Ze,[m(s,{name:"mobile",modelValue:e.subComponent.account,"onUpdate:modelValue":o[2]||(o[2]=r=>e.subComponent.account=r),placeholder:e.$t("web_3_sign_input"),disabled:!0},null,8,["modelValue","placeholder"])]),t("div",xe,[eo,m(s,{modelValue:e.password,"onUpdate:modelValue":o[3]||(o[3]=r=>e.password=r),ref:"mobileLoginPwd",placeholder:e.$t("web_3_sign_psw"),onKeyup:B(e.emailLoginByPwd,["enter","native"]),"show-password":""},null,8,["modelValue","placeholder","onKeyup"])]),t("div",oo,[I(t("div",{class:"login_error el-icon-warning"},a(e.subComponent.loginMsg),513),[[q,e.subComponent.loginErrorShow]]),t("a",{onClick:o[4]||(o[4]=(...r)=>e.toForgat&&e.toForgat(...r))},a(e.$t("web_3_sign_forget")),1)]),t("div",{class:"btn_green login_btn_bottom",onClick:o[5]||(o[5]=(...r)=>e.emailLoginByPwd&&e.emailLoginByPwd(...r))},a(e.$t("web_3_sign_btn")),1)])])}const io=N(Fe,[["render",to],["__scopeId","data-v-0e55d652"]]),no=M({components:{tooltipBlack:ne},data:function(){return{type:this.$route.query.type,qrl_id:"",qrl_image_src:"",qr_mask_show:!1,download_wrap_show:!1,download_url:"",download_type:"",fileName:"",qr_code_show:!0,checkInterval:0,tooltipUpper:b.tooltipUpper,tooltipRight:b.tooltipRight,tooltipLower:b.tooltipLower,tooltipLeft:b.tooltipLeft}},computed:{},created(){this.init()},methods:{emailBack(){const e=this.$parent;clearInterval(this.checkInterval),e.emailBack()},open_the_file(){const e=this;e.download_url&&(/\/share\/show?/.test(e.download_url)||/\/s\//.test(e.download_url)||/\/ss\//.test(e.download_url)?window.open(e.download_url):window.open(b.macro.V3_MAIN_DOMAIN+"/download/print?redirect_uri="+encodeURIComponent(e.download_url)))},print_the_file(){const e=this;e.download_url&&(/\/share\/show?/.test(e.download_url)||/\/s\//.test(e.download_url)||/\/ss\//.test(e.download_url)?W(e.download_url,e.fileName).then(o=>{window.open(b.macro.V3_MAIN_DOMAIN+"/download/print?redirect_uri="+encodeURIComponent(o.data))}):window.open(b.macro.V3_MAIN_DOMAIN+"/download/print?redirect_uri="+encodeURIComponent(e.download_url)))},download_the_file(){const e=this;e.download_url&&(/\/share\/show?/.test(e.download_url)||/\/s\//.test(e.download_url)||/\/ss\//.test(e.download_url)?W(e.download_url,e.fileName).then(o=>{window.open(o.data)}):window.open(e.download_url))},init(){const e=this;let o=[];e.type?o=[e.type]:o=["login"],we(o).then(n=>(e.qrl_id=n.qrl_id,n.qrl_id)).then(n=>{e.qrl_image_src=b.api.API_QR_LOGIN+"/image?qrl_id="+n}).catch(n=>{throw new Error(n)}),e.download_wrap_show=!1,e.qr_mask_show=!1,e.qr_query()},qr_query(){const e=this;this.checkInterval=window.setInterval(function(){fe(e.qrl_id).then(async o=>{o.data.status===4?(clearInterval(e.checkInterval),e.qr_mask_show=!0):o.data.status===3&&(e.qr_code_show=!1,o.data.type==="transfer"?(e.download_url=o.data.file_link,e.download_type=o.data.file_type,o.data.file_name?e.fileName=o.data.file_name:(e.fileName="CS_"+e.capitalizeFirstLetter(e.download_type),o.data.create_time&&(e.fileName+="_"+be(Number(o.data.create_time)))),e.download_wrap_show=!0):o.data.type==="webocr"?e.$router.push({name:"webocr",params:{token:o.data.token,link:o.data.file_link}}):o.data.type==="login"&&(await S(o.data.apis),A(o.data.token).then(n=>{ve(),w("signin","sign_qr","qr_login_success"),j(e,n)}).catch(n=>{throw w("signin","sign_qr","qr_login_failed"),n})),clearInterval(e.checkInterval))})},3e3)},capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}}});const se=e=>(O("data-v-c1921cec"),e=e(),D(),e),so={class:"step_scan_login"},lo={class:"login_main"},ao={class:"scan_wrap"},ro={class:"h1_wrap"},co={class:"login_h1"},_o=se(()=>t("i",null,null,-1)),po={class:"qr-code-box"},uo={key:0,class:"default_qrcode",src:ye,alt:""},go=["src"],ho={key:2,class:"mask_wrap"},mo=se(()=>t("div",{class:"qr_mask"},null,-1)),wo={class:"refresh_tip"},fo={class:"scan-desc"};function bo(e,o,n,i,p,u){const l=g("tooltipBlack");return _(),f("div",so,[t("div",lo,[t("div",ao,[t("i",{class:"login_ic",onClick:o[0]||(o[0]=(...d)=>e.emailBack&&e.emailBack(...d))},[m(l,{direction:e.tooltipUpper,i18nKey:"web_3_login_with_account"},null,8,["direction"])])]),t("div",ro,[t("div",co,[t("h1",null,a(e.$t("web_3_sign_scan")),1),_o])]),t("div",po,[e.qrl_image_src?(_(),f("img",{key:1,class:"qr-code",src:e.qrl_image_src,alt:""},null,8,go)):(_(),f("img",uo)),e.qr_mask_show?(_(),f("div",ho,[mo,t("a",{class:"btn_green refresh_btn",id:"refresh_btn",onClick:o[1]||(o[1]=(...d)=>e.init&&e.init(...d))},a(e.$t("cc_cs_refesh")),1),t("div",wo,a(e.$t("web_3_sign_scanfail")),1)])):y("",!0),t("p",fo,a(e.$t("web_3_sign_scantip")),1)])])])}const vo=N(no,[["render",bo],["__scopeId","data-v-c1921cec"]]),yo=M({components:{},data:function(){return{supervcode:"",password:"",vcode:"",step:"frist",params:"",hasEmail:!1,areaCode:"",vcodeText:this.$t("web_3_register_codebtn"),captureObject:null,timeIntercal:0}},computed:{subComponent(){return this.$parent}},created(){const e=this.$parent,o=E();this.hasEmail=o.test(e.account),this.areaCode=e.getAreaCode()||"",e.hideMsg()},beforeUnmount(){this.timeIntercal&&clearInterval(this.timeIntercal)},methods:{async initGt(e){const o=this;window.initGeetest({gt:e.gt,challenge:e.challenge,new_capture:!0,product:"bind",lang:o.$i18n.locale,https:!0},function(n){n.onReady(function(){var i;o.captureObject=n,(i=o.captureObject)==null||i.verify()}).onSuccess(function(){var u;const i=(u=o.captureObject)==null?void 0:u.getValidate(),p={};Object.keys(i).map(l=>p["jy_"+l]=i[l]),o.gtsendVcode(Object.assign(p,{jy_old_challenge:e.challenge}))}).onError(function(){})})},async gtsendVcode(e={}){const o=this,n=Object.assign(e,{language:navigator.language.toLocaleLowerCase(),timestamp:new Date().getTime()});n.sign_type="md5",this.hasEmail?(n.email=this.subComponent.account,n.reason="login"):(n.email=this.subComponent.account,n.reason="login",n.area_code=this.areaCode),v("account",this.subComponent.account,V()*365),await S(),n.sign=$(R(n)),te(n).then(i=>{i.data&&i.data.success===1&&i.ret===10202?o.initGt(i.data):o.sendSuccess()}).catch(i=>{throw i.xerrcode&&o.subComponent.vCodeSendMsg(),i})},sendSuccess(){let e=60;const o=this;o.timeIntercal=window.setInterval(()=>{o.vcodeText=o.$t("web_3_resend",[e--]),e===-1&&(o.vcodeText=this.$t("web_3_register_codebtn"),e=60,clearInterval(o.timeIntercal))},1e3)},verifyVode(e={}){this.subComponent.emailLoginByPwd("",this.vcode,this.hasEmail?"mailVcodeLogin":"mobileVcodeLogin",this.areaCode,e)},fristBack(){this.subComponent.hideMsg(),this.step="frist"},checkCode(){this.subComponent.hideMsg(),this.step="second"},emailBack(){this.subComponent.emailBack()},async fetchUid(e){const o={};E().test(e)?o.email=e:o.mobile=e;try{return await ie(o),{uid:window["x-is-userid"]}}catch(n){return{xerrcode:n.xerrcode}}},async emailLoginByPwd(){const e=await this.fetchUid(this.subComponent.account);let o;e.uid&&(o=$(this.supervcode,"_IntSig",16),o=$(o,"_"+e.uid,16)),this.subComponent.emailLoginByPwd(o,"","security",this.areaCode)}}});const $o=e=>(O("data-v-948b438e"),e=e(),D(),e),ko={class:"step_email_login"},Lo={key:0,class:"login_main"},Co={class:"login_back"},So={class:"login-text"},Vo={class:"login_title"},Eo={class:"send_text"},Bo={class:"login_input"},To={class:"security_input"},Io={class:"login_pass"},qo={key:1,class:"login_main"},Mo=$o(()=>t("i",{class:"cs-icon-arrow-left"},null,-1)),No={class:"login-text"},Uo={class:"login_title"},Po={class:"send_text"},jo={class:"login_input"},Ro={class:"login_pass"},Ao={class:"waring_text"};function Oo(e,o,n,i,p,u){const l=g("el-input"),d=g("el-button");return _(),f("div",ko,[e.step==="frist"?(_(),f("div",Lo,[t("div",Co,[t("i",{class:"cs-icon-arrow-left",onClick:o[0]||(o[0]=(...s)=>e.emailBack&&e.emailBack(...s))}),t("div",So,[t("h2",Vo,a(e.$t("web_3_sign_second")),1)])]),t("p",Eo,a(e.$t("web_3_sign_secondtip",[""]))+a(e.hasEmail?"":"+")+a(e.areaCode)+" "+a(e.subComponent.account),1),t("div",Bo,[t("div",To,[m(l,{placeholder:e.$t("web_3_register_code"),onKeyup:B(e.verifyVode,["enter","native"]),modelValue:e.vcode,"onUpdate:modelValue":o[1]||(o[1]=s=>e.vcode=s),modelModifiers:{trim:!0}},null,8,["placeholder","onKeyup","modelValue"]),m(d,{type:"text",disabled:e.vcodeText!=e.$t("web_3_register_codebtn"),onClick:e.gtsendVcode},{default:C(()=>[T(a(e.vcodeText),1)]),_:1},8,["disabled","onClick"])])]),t("div",Io,[I(t("div",{class:"login_error el-icon-warning"},a(e.subComponent.loginMsg),513),[[q,e.subComponent.loginErrorShow]])]),t("div",{class:"btn_green login_btn_bottom",onClick:o[2]||(o[2]=(...s)=>e.verifyVode&&e.verifyVode(...s))},a(e.$t("web_3_sign_btn")),1),t("p",{class:"check_code",onClick:o[3]||(o[3]=(...s)=>e.checkCode&&e.checkCode(...s))},a(e.$t("web_3_sign_supercode")),1)])):(_(),f("div",qo,[t("div",{class:"login_back",onClick:o[4]||(o[4]=(...s)=>e.fristBack&&e.fristBack(...s))},[Mo,t("div",No,[t("h2",Uo,a(e.$t("web_3_sign_supercode")),1)])]),t("p",Po,a(e.$t("web_3_sign_supercodetip")),1),t("div",jo,[m(l,{onKeyup:B(e.emailLoginByPwd,["enter","native"]),placeholder:e.$t("web_3_sign_supercode_input"),modelValue:e.supervcode,"onUpdate:modelValue":o[5]||(o[5]=s=>e.supervcode=s),modelModifiers:{trim:!0}},null,8,["onKeyup","placeholder","modelValue"])]),t("div",Ro,[I(t("div",{class:"login_error el-icon-warning"},a(e.$t("web_3_login_wrongpsw")),513),[[q,e.subComponent.loginErrorShow]])]),t("div",{class:"btn_green login_btn_bottom",onClick:o[6]||(o[6]=(...s)=>e.emailLoginByPwd&&e.emailLoginByPwd(...s))},a(e.$t("web_3_sign_btn")),1),t("p",Ao,a(e.$t("web_3_sign_supercode_ps")),1)]))])}const Do=N(yo,[["render",Oo],["__scopeId","data-v-948b438e"]]);let Y={};const h="CSSignIn",Fo=M({components:{emailLogin:De,mobileLogin:io,qrcodeLogin:vo,verifyLogin:Do,loginHeader:Be,tooltipBlack:ne},props:{type:{type:String,default:""}},watch:{areaCode(e){e&&(v("area_code",e,V()*365),S().then(()=>{}))},loginStep(e){this.hasElectron&&window.desktopVersion&&P(window.desktopVersion,"1.0.1")&&this.$route.name==="login"&&this.$nextTick(()=>{const o=document.getElementsByClassName("login_wrap")[0];window.ipcRenderer.send("reSize-window",520,o.offsetHeight+300)}),e==="step_email_login"||e==="step_mobile_login"?(history.pushState(null,"",document.URL),window.addEventListener("popstate",this.goBack,!1)):window.removeEventListener("popstate",this.goBack,!1),this.clickListener()}},data:function(){return{platform:this.$route.query.platform,source:this.$route.query.source,replacePage:this.$route.query.page,loginStep:"step_first",account:"",password:"",loginErrorShow:!1,autoLogin:!0,loginMsg:"",loginFirstErr:"",loginType:"pwd",vcodeText:this.$t("web_3_register_codebtn"),verifyCode:"",areaCode:"",client_id:"",captureObject:null,gtRes:null,tooltipUpper:b.tooltipUpper,tooltipRight:b.tooltipRight,tooltipLower:b.tooltipLower,tooltipLeft:b.tooltipLeft,captureType:"login",areaMap:[],timeIntercal:0,from:""}},mounted(){this.hasElectron&&(this.autoLogin=!0),this.checkLoginType("pwd"),this.hasElectron&&window.desktopVersion&&P(window.desktopVersion,"1.0.1")&&this.$route.name==="login"&&window.ipcRenderer.send("minSize-window");const e=this.$route.query.from||"";this.from=e,e?ge.page(h,{from_source:e}):w(h,"pv"),this.clickListener()},computed:{...he(H,["token"]),v3Host(){return b.macro.V3_MAIN_DOMAIN},hasElectron(){return $e()}},beforeUnmount(){this.timeIntercal&&clearInterval(this.timeIntercal)},unmounted(){window.removeEventListener("popstate",this.goBack,!1)},created(){const e=this;this.platform&&this.platform==="scan"&&(this.loginStep="step_scan_login"),this.areaMap=ee(this.$i18n.locale),this.areaCode=oe()[this.$i18n.locale].split(",")[0],this.checkForgat();let o="";this.token?o=this.token:k("S2")&&(o=k("S2")),this.client_id=k("client_id")?k("client_id"):"",this.client_id||(this.client_id=ke()),this.type!=="dialog"&&(o&&A(o).then(n=>{n.token.token?(j(e,n).then(()=>{}),G({token:n.token.token,version:"v4"}).then(()=>{})):Q()}).catch(n=>{throw Q(),n}),this.hasElectron&&this.beginLogin())},methods:{clickListener(){const e=this;this.$nextTick(()=>{document.getElementsByClassName("login_desc")[0]&&document.getElementsByClassName("login_desc")[0].addEventListener("click",function(o){const n=o.target;n.className==="desk_open"&&(e.hasElectron&&window.desktopVersion&&P(window.desktopVersion,"1.0.0")?window.ipcRenderer.send("open-window",n.getAttribute("href")):window.open(n.getAttribute("href")))})})},async initGt(e){const o=this;window.initGeetest({gt:e.gt,challenge:e.challenge,new_capture:!0,product:"bind",lang:o.$i18n.locale,https:!0},function(n){n.onReady(function(){var i;o.captureObject=n,(i=o.captureObject)==null||i.verify()}).onSuccess(function(){var u;const i=(u=o.captureObject)==null?void 0:u.getValidate(),p={};Object.keys(i).map(l=>p["jy_"+l]=i[l]),o.captureType==="login"?o.gtLogin(Object.assign(p,{jy_old_challenge:e.challenge})):o.captureType==="vcode"?o.gtsendVcode(Object.assign(p,{jy_old_challenge:e.challenge})):o.captureType==="verifyVcode"?o.$refs.verifyLogin.verifyVode(Object.assign(p,{jy_old_challenge:e.challenge})):o.captureType==="vcodeLogin"&&o.emailLoginByPwd("",o.verifyCode,"verify",o.areaCode,Object.assign(p,{jy_old_challenge:e.challenge}))}).onError(function(){})})},gtLogin(e={}){const o=this,n=Object.assign(e,Y);n.sign=$(R(n)),Se(n).then(i=>{i.data&&i.data.success===1&&i.ret===10202?o.initGt(i.data).then(()=>{}):this.loginSuccess(i)}).catch(i=>{this.loginSuccess(i)})},gtsendVcode(e={}){const o=this,n=Object.assign(e,{mobile:this.account,area_code:this.areaCode,reason:"login",language:navigator.language.toLocaleLowerCase(),timestamp:new Date().getTime()});n.sign=$(R(n)),n.sign_type="md5",te(n).then(i=>{i.data&&i.data.success===1&&i.ret===10202?this.initGt(i.data).then(()=>{}):o.sendSuccess()}).catch(i=>{throw i.xerrcode&&o.vCodeSendMsg(),i})},beginLogin(){const e=this,o=k("encodeAct"),n=k("tokenPwd");if(this.client_id&&n)try{const i=J(o),p=E(),u={account:i,client_id:this.client_id,token_pwd:J(n)};p.test(i)?u.account_type="email":u.account_type="mobile",Ve(u).then(l=>{l&&l.ret===0?A(l.login_token).then(d=>{w(h,"signpsw","success"),j(e,d,h).then(()=>{}),G({token:d.token.token,version:"v4"}).then(()=>{})}).catch(d=>{throw K(this),d}):K(this)})}catch(i){throw K(this),i}},async sendVcode(){if(this.captureType="vcode",isNaN(Number(this.account))||!this.account.trim()){this.loginErrorShow=!0,this.loginMsg=this.$t("web_3_register_worryphone");return}v("account",this.account,V()*365),await S(),this.gtsendVcode()},sendSuccess(){let e=60;const o=this;o.timeIntercal=window.setInterval(()=>{o.vcodeText=`${e--}s`,e===-1&&(o.vcodeText=this.$t("web_3_register_codebtn"),e=60,clearInterval(o.timeIntercal))},1e3)},checkLoginType(e){this.loginType=e,this.hasElectron&&window.desktopVersion&&P(window.desktopVersion,"1.0.1")&&this.$route.name==="login"&&this.$nextTick(()=>{window.ipcRenderer.send("reSize-window",520,document.getElementsByClassName("login_wrap")[0].offsetHeight+300)})},goBack(){this.loginStep==="step_mobile_login"&&(this.loginStep="step_first")},checkForgat(){const e=k("forgat_ac");e&&(this.account=e,this.checkAccount())},toRegiste(){if(this.type){if(this.$route.query.lp==="sem"){if(!window._hmt)return;window._hmt.push(["_trackEvent","活动推广","进入注册页"])}this.$emit("checkRegister")}else if(this.$route.query.lp==="sem"){if(this.$router.push({path:"/register",query:{lp:"sem"}}),!window._hmt)return;window._hmt.push(["_trackEvent","活动推广","进入注册页"])}else this.$router.push("/register")},checkScanLogin(){this.loginStep="step_scan_login"},getAreaCode(){if(this.$refs.mobileLogin)return this.$refs.mobileLogin.areaCode||""},checkAccount(){const e=E();if(!e.test(this.account)&&isNaN(Number(this.account))||!this.account){this.loginFirstErr=this.$t("web_3_login_worryaccount");return}e.test(this.account)?this.loginStep="step_email_login":(this.loginStep="step_mobile_login",this.account=this.account.replace(new RegExp("\\+","g"),"")),this.account=this.account.trim(),v("account",this.account,V()*365),S().then(()=>{}),this.hideMsg(),window.history&&window.history.pushState&&window.addEventListener("popstate",this.goBack,!1)},emailBack(){Le("forgat_ac"),this.loginFirstErr="",this.loginErrorShow=!1,this.loginStep="step_first",window.removeEventListener("popstate",this.goBack,!1)},hideMsg(){this.loginErrorShow=!1},vcodeLogin(){if(isNaN(Number(this.account))||!this.account.trim()){this.loginErrorShow=!0,this.loginMsg=this.$t("web_3_register_worryphone");return}if(isNaN(Number(this.verifyCode))||!this.verifyCode.trim()){this.loginErrorShow=!0,this.loginMsg=this.$t("web_3_register_code");return}this.emailLoginByPwd("",this.verifyCode,"verify",this.areaCode).then(()=>{})},async emailLoginByPwd(e,o="",n="",i="",p={}){const u=E();let l="";const d=u.test(this.account);d?l="email":l="mobile",this.password=e;let s={};if(o)n==="mailVcodeLogin"?(this.captureType="verifyVcode",s.email=this.account):n==="mobileVcodeLogin"?(this.captureType="verifyVcode",s.mobile=this.account,s.area_code=i):(this.captureType="vcodeLogin",s.mobile=this.account,s.area_code=i),s.vcode=o,s.reason="login",s.timestamp=new Date().getTime(),s["jy_"+l]=this.account,s.sign_type="md5",s.client="webcs_WEB",s.client_app="web_"+b.appName+"@"+b.appVersion,s.client_id=this.client_id,s=Object.assign(p,s),s.sign=$(R(s)),Ee(s).then(r=>{r.data&&r.data.success===1&&r.ret===10202?this.initGt(r.data):this.loginSuccess(r,!0)}).catch(r=>{this.loginSuccess(r)});else{this.captureType="login",n==="password"?s={user:this.account,area_code:i,password:this.password,rememberme:this.autoLogin?1:0,type:l}:n==="security"?(s={user:this.account,reason:"verify_user",secret:e,rememberme:this.autoLogin?1:0,type:l},d||(s.area_code=i)):s={user:this.account,password:this.password,rememberme:this.autoLogin?1:0,type:l},s.client_id=this.client_id,s["jy_"+l]=this.account,this.areaCode=i,s.client="webcs_WEB",s.client_app=`web_camscanner@${b.appVersion}`,s.sign_type="md5",s.token_life=this.autoLogin?604800:604800/7,s.auto_login=0;const r=await this.fetchUid(this.account);if(r.uid&&s.password&&(s.password=$(s.password,"_IntSig",16),s.password=$(s.password,"_"+r.uid,16)),r.xerrcode==="201"){w(h,"signpsw","failed"),w(h,"login_in","login_in_failed"),this.loginErrorShow=!0,this.loginMsg=this.$t("web_3_login_unregister_account");return}Y=s,this.gtLogin()}},async fetchUid(e){const o={};E().test(e)?o.email=e:o.mobile=e;try{return await ie(o),{uid:window["x-is-userid"]}}catch(n){return{xerrcode:n.xerrcode}}},vCodeSendMsg(){this.loginErrorShow=!0,this.loginMsg=this.$t("web_3_register_code_sendfailed")},vCodeVerifyMsg(){this.loginErrorShow=!0,this.loginMsg=this.$t("web_3_login_invalidcode")},loginSuccess(e,o){let n=!0;o&&(n=o);const i=this;if(e.xerrcode){const l=parseInt(e.xerrcode);if(l===217){w(h,"signpsw","failed"),w(h,"login_in","login_in_failed"),i.loginStep="step_verify_login";return}else if(l===201){w(h,"signpsw","failed"),w(h,"login_in","login_in_failed"),i.loginErrorShow=!0,i.loginMsg=i.$t("web_3_login_unregister_account");return}else if(l===107){w(h,"signpsw","failed"),w(h,"login_in","login_in_failed"),i.loginMsg=i.$t("web_3_login_invalidcode"),i.loginErrorShow=!0;return}else{w(h,"signpsw","failed"),w(h,"login_in","login_in_failed"),i.loginMsg=i.$t("web_3_login_wrongpsw"),i.loginErrorShow=!0;return}}if(w(h,"login_in","login_in"),e.profile){let l={};e.profile.edu_auth?l=e.profile.edu_auth:e.profile.edu_af&&(l=e.profile.edu_af),l&&Number(l.expiry)>Date.parse(new Date().toString())/1e3&&(H().setUserType({userType:b.userTypeEdu}),H().setUserTypeTime({userTypeTime:Number(l.expiry)}))}let p="",u="";if(e&&e.token&&e.token.token?(p=e.token.token,u=e.token.token_pwd):e&&e.data&&e.data.token&&(p=e.data.token,u=e.data.token_pwd),!p){w(h,"signpsw","failed"),w(h,"login_in","login_in_failed"),i.loginMsg=i.$t("web_3_login_wrongpsw"),i.loginErrorShow=!0;return}A(p).then(l=>{w(h,"signpsw","success"),n&&i.hasElectron&&(v("encodeAct",X(this.account),new Date().getTime()+60*1e3*60*24*365),v("client_id",this.client_id,new Date().getTime()+60*1e3*60*24*365),u&&v("tokenPwd",X(u),new Date().getTime()+60*1e3*60*24*365)),j(i,l,h),G({token:l.token.token,version:"v4"})}).catch(l=>{throw l.status===406&&l.xerrcode==="105"&&(i.loginMsg=i.$t("web_3_login_wrongpsw"),i.loginErrorShow=!0),l})},accountEntry(){v("account",this.account,V()*365),S().then(()=>{})}}});const U=e=>(O("data-v-809f443d"),e=e(),D(),e),Ko={class:"main"},Go=U(()=>t("img",{class:"login-logo",src:Ce,alt:""},null,-1)),Ho={key:0,class:"step_first"},zo={class:"login_box"},Wo={class:"login_main"},Qo={class:"scan_wrap"},Jo=U(()=>t("i",null,null,-1)),Xo=U(()=>t("i",null,null,-1)),Yo={class:"login_title"},Zo=["innerHTML"],xo={key:0,class:"pwd_login"},et={class:"login_input"},ot={key:0,class:"login_err"},tt={key:1,class:"login_auto_checkbox"},it={key:1,class:"vcode_login"},nt={class:"vcode_input noborder_put"},st={class:"vcode_input"},lt={class:"vcode_input"},at={class:"login_pass"},rt={key:0,class:"login_auto_checkbox"},dt={class:"register_footer"},ct={class:"division_line"},_t=U(()=>t("i",null,null,-1)),pt=U(()=>t("i",null,null,-1));function ut(e,o,n,i,p,u){const l=g("loginHeader"),d=g("tooltipBlack"),s=g("el-input"),r=g("WarningFilled"),le=g("el-icon"),z=g("el-checkbox"),ae=g("el-option"),re=g("el-select"),de=g("el-button"),ce=g("emailLogin"),_e=g("mobileLogin"),pe=g("qrcodeLogin"),ue=g("verifyLogin");return _(),f("div",Ko,[!e.hasElectron&&!e.type?(_(),L(l,{key:0})):y("",!0),t("div",{class:F(["main_body_wrap",e.hasElectron?"electron_wrap":""]),style:{"-webkit-app-region":"drag"}},[Go,t("div",{class:"login_wrap",style:me(e.type?"position: static;":"")},[e.loginStep==="step_first"?(_(),f("div",Ho,[t("div",zo,[t("div",Wo,[t("div",Qo,[t("i",{class:"login_ic",onClick:o[0]||(o[0]=(...c)=>e.checkScanLogin&&e.checkScanLogin(...c))},[m(d,{direction:e.tooltipUpper,i18nKey:"web_3_sign_scan"},null,8,["direction"])])]),t("div",{class:F(["login_h1",e.loginType==="pwd"?"login_select":""]),onClick:o[1]||(o[1]=c=>e.checkLoginType("pwd"))},[t("h1",null,a(e.$t("web_3_login_viapsw")),1),Jo],2),t("div",{class:F(["login_h1",e.loginType==="vcode"?"login_select":""]),onClick:o[2]||(o[2]=c=>e.checkLoginType("vcode"))},[t("h1",null,a(e.$t("web_3_login_vialicensecode")),1),Xo],2),t("div",Yo,a(e.$t("web_3_sign_welcome")),1),t("div",{class:"login_desc",innerHTML:e.$t("web_3_sign_tip",["<span class='desk_open' href="+e.v3Host+"/app/service?language="+e.$i18n.locale+">"+e.$t("web_3_sign_service")+"</span>","<span class='desk_open' href="+e.v3Host+"/web/privacy?language="+e.$i18n.locale+">"+e.$t("web_3_sign_privacy")+"</span>"])},null,8,Zo),e.loginType==="pwd"?(_(),f("div",xo,[t("div",et,[m(s,{modelValue:e.account,"onUpdate:modelValue":o[3]||(o[3]=c=>e.account=c),modelModifiers:{trim:!0},onKeyup:B(e.checkAccount,["enter","native"]),autofocus:!0,placeholder:e.$t("web_3_sign_input")},null,8,["modelValue","onKeyup","placeholder"])]),e.loginFirstErr?(_(),f("p",ot,[m(le,null,{default:C(()=>[m(r)]),_:1}),T(" "+a(e.loginFirstErr),1)])):y("",!0),t("div",{class:"btn_green login_btn",onClick:o[4]||(o[4]=(...c)=>e.checkAccount&&e.checkAccount(...c))},a(e.$t("web_3_sign_btn")),1),e.hasElectron?y("",!0):(_(),f("div",tt,[m(z,{modelValue:e.autoLogin,"onUpdate:modelValue":o[5]||(o[5]=c=>e.autoLogin=c)},{default:C(()=>[T(a(e.$t("web_3_sign_week")),1)]),_:1},8,["modelValue"])]))])):y("",!0),e.loginType==="vcode"?(_(),f("div",it,[t("div",nt,[m(re,{modelValue:e.areaCode,"onUpdate:modelValue":o[6]||(o[6]=c=>e.areaCode=c),placeholder:e.$t("cs_648_login_select")},{default:C(()=>[(_(!0),f(Z,null,x(e.areaMap,c=>(_(),L(ae,{key:c.index,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),t("div",st,[m(s,{name:"mobile",onBlurCapture:e.accountEntry,modelValue:e.account,"onUpdate:modelValue":o[7]||(o[7]=c=>e.account=c),modelModifiers:{trim:!0},placeholder:e.$t("web_3_register_mobileinput")},null,8,["onBlurCapture","modelValue","placeholder"])]),t("div",lt,[m(s,{style:{width:"200px"},modelValue:e.verifyCode,"onUpdate:modelValue":o[8]||(o[8]=c=>e.verifyCode=c),modelModifiers:{trim:!0},onKeyup:B(e.vcodeLogin,["enter","native"]),placeholder:e.$t("web_3_register_code")},null,8,["modelValue","onKeyup","placeholder"]),m(de,{onClick:e.sendVcode,disabled:e.vcodeText!=e.$t("web_3_register_codebtn")},{default:C(()=>[T(a(e.vcodeText),1)]),_:1},8,["onClick","disabled"])]),t("div",at,[I(t("div",{class:"login_error el-icon-warning"},a(e.loginMsg),513),[[q,e.loginErrorShow]])]),t("div",{class:"btn_green login_btn_bottom",onClick:o[9]||(o[9]=(...c)=>e.vcodeLogin&&e.vcodeLogin(...c))},a(e.$t("web_3_sign_btn")),1),e.hasElectron?y("",!0):(_(),f("div",rt,[m(z,{modelValue:e.autoLogin,"onUpdate:modelValue":o[10]||(o[10]=c=>e.autoLogin=c)},{default:C(()=>[T(a(e.$t("web_3_sign_week")),1)]),_:1},8,["modelValue"])]))])):y("",!0),t("div",dt,[t("div",ct,[_t,t("span",null,a(e.$t("web_3_sign_noaccount")),1),pt]),t("a",{onClick:o[11]||(o[11]=(...c)=>e.toRegiste&&e.toRegiste(...c))},a(e.$t("web_3_sign_create")),1)])])])])):e.loginStep==="step_email_login"?(_(),L(ce,{key:1})):e.loginStep==="step_mobile_login"?(_(),L(_e,{key:2,ref:"mobileLogin"},null,512)):e.loginStep==="step_scan_login"?(_(),L(pe,{key:3})):e.loginStep==="step_verify_login"?(_(),L(ue,{key:4,ref:"verifyLogin"},null,512)):y("",!0)],4)],2)])}const Ct=N(Fo,[["render",ut],["__scopeId","data-v-809f443d"]]);export{Ct as default};
